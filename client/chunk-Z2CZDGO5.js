import{a as J}from"./chunk-LN7LOY6B.js";import{a as P}from"./chunk-6OUJ5KKQ.js";import{a as W,b as z,c as K,d as Q,e as X,f as Y,g as Z,h as tt,i as et,j as it,k as ot,l as rt}from"./chunk-XIMSBLFQ.js";import{c as m}from"./chunk-PLASC6FB.js";import"./chunk-5AG4EMNI.js";import{e as p}from"./chunk-O2YGMG24.js";import{$ as g,A as R,D as L,E as N,Ga as u,Ia as d,O as r,Q as f,R as M,Ua as q,W as U,_a as _,a as v,b as V,da as k,e as D,ha as n,i as l,ia as s,ib as x,ja as j,ma as B,na as O,oa as b,qb as $,ra as E,s as G,w as C,xa as h,ya as I,z as c,za as H}from"./chunk-FKNLQJGV.js";var nt=()=>{let i=R(m),t=R(x);return i.stateItem$.pipe(l(e=>(e&&t.navigateByUrl(i.redirectUrl||p.Basic.defaultRoute),!0)))};var w=i=>{let t=i.records?.length?i.records[0]:null;return v(v({},t),t?.attributes)};var S=class{static NewInstance(t){let e=JSON.parse(atob(t.access_token.split(".")[1]));return e?{accessToken:t.access_token,expiresAt:e.expires*1e3,payload:P.NewInstance(t)}:null}static PrepAccessToken(t,e){return{shortname:t,password:e}}static PrepReset(t,e){return{Code:e,Password:t}}static PrepSave(t){return`newPassword=${t.newPassword}&oldPassword=${t.password}`}static PrepForgot(t){return`email=${t}`}};var A=class i{constructor(t,e){this._http=t;this.authState=e}_detailsUrl=p.API.profile.details;GetProfile(t){return this._http.get(this._detailsUrl).pipe(l(e=>{let a=P.NewInstance(w(e)),o=V(v({},t),{payload:a});return this.authState.SaveSession(o),o}))}static \u0275fac=function(e){return new(e||i)(c(_),c(m))};static \u0275prov=C({token:i,factory:i.\u0275fac,providedIn:"root"})};var F=class i{constructor(t,e,a){this.http=t;this.authState=e;this.profileService=a;_seqlog("authservices construct")}_loginUrl=p.API.auth.login;SendCode(t){return this.http.post(p.API.auth.sendCode,{username:t}).pipe(l(e=>({code:1244})))}Login(t,e){let a=S.PrepAccessToken(t,e);return this.http.post(this._loginUrl,a).pipe(l(o=>{let T=S.NewInstance(w(o));return this.authState.SaveSession(T)}),G(o=>this.profileService.GetProfile(o)))}Logout(){}static \u0275fac=function(e){return new(e||i)(c(_),c(m),c(A))};static \u0275prov=C({token:i,factory:i.\u0275fac,providedIn:"root"})};function ct(i,t){if(i&1){let e=B();n(0,"form",3),O("submit",function(){L(e);let o=b();return N(o.sendCode())}),n(1,"h2",4),h(2),u(3,"translate"),s(),n(4,"div",5)(5,"cr-input",6),u(6,"translate"),j(7,"input",7),s()(),n(8,"div")(9,"button",8),h(10),u(11,"translate"),s()()()}if(i&2){let e=b();g("formGroup",e.codeForm),r(2),I(d(3,5,"Login","Login")),r(3),E("placeholder",d(6,8,"Email or mobile number","EmailOrMobileNo")),r(2),g("required",!0),r(3),I(d(11,11,"Login","Login"))}}function ut(i,t){if(i&1){let e=B();n(0,"form",3),O("submit",function(){L(e);let o=b();return N(o.login())}),n(1,"h2",4),h(2),u(3,"translate"),s(),n(4,"div",5)(5,"p"),h(6),s(),n(7,"cr-input",6),u(8,"translate"),j(9,"input",9),s()(),n(10,"div")(11,"button",8),h(12),u(13,"translate"),s()()()}if(i&2){let e=b();g("formGroup",e.loginForm),r(2),I(d(3,6,"Submit","Submit")),r(4),H(" We have sent you a code to ",e.codeForm.value.username,". Please enter the code below. "),r(),E("placeholder",d(8,9,"Insert code","InsertCode")),r(2),g("required",!0),r(3),I(d(13,12,"Submit","Submit"))}}var y=class i{constructor(t,e,a,o,T){this.toast=t;this.fb=e;this.router=a;this.authState=o;this.authService=T}loginForm;codeForm;_credentials=new D({username:"",code:""});stage="login";ngOnInit(){this.codeForm=this.fb.group({username:[]}),this.loginForm=this.fb.group({code:[]})}sendCode(){if(this.toast.Hide(),this.loginForm.valid){let t=this.loginForm.value;this.stage="code",this._credentials.next({username:t.username,code:"1234"})}else this.toast.ShowError("INVALID_FORM")}login(){if(this.toast.Hide(),this.loginForm.valid){let t=this.loginForm.value,e=this._credentials.getValue();if(t.code!==e.code){this.toast.ShowError("INVALID_CODE");return}this.router.navigateByUrl(this.authState.redirectUrl||p.Basic.defaultRoute)}else this.toast.ShowError("INVALID_FORM")}static \u0275fac=function(e){return new(e||i)(f(it),f(tt),f(x),f(m),f(F))};static \u0275cmp=M({type:i,selectors:[["ng-component"]],decls:4,vars:1,consts:[[1,"center-content"],[1,"container","md-6"],["novalidate","",3,"formGroup"],["novalidate","",3,"submit","formGroup"],[1,"f5","doublespaced","weight-bold"],[1,"doublespaced"],[3,"placeholder"],["type","text","id","username","crinput","","formControlName","username","autocomplete","username",1,"w100",3,"required"],["type","submit",1,"btn-rev","btn-colored","w100","btn-large"],["type","text","id","code","crinput","","formControlName","code",1,"w100",3,"required"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1),U(2,ct,12,14,"form",2)(3,ut,14,15,"form",2),s()()),e&2&&(r(2),k(a.stage==="login"?2:3))},dependencies:[q,$,J,et,Q,W,z,K,Z,X,Y,ot,rt],encapsulation:2,changeDetection:0})};var te=[{path:"",redirectTo:"/dashboard",pathMatch:"full"},{path:"login",component:y,resolve:{login:nt}}];export{te as PublicRoutes};
