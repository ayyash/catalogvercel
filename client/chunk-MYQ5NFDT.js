import{a as Dt}from"./chunk-6OUJ5KKQ.js";import{a as Mt,b as et}from"./chunk-MSZ2SVTZ.js";import{a as _t,b as bt,c as yt,d as St,e as Lt,f as xt,g as wt,h as Ot,i as Nt,j as Tt,k as Ft,l as Et}from"./chunk-XIMSBLFQ.js";import{c as tt}from"./chunk-5AG4EMNI.js";import{a as Ct,b as G,e as v}from"./chunk-O2YGMG24.js";import{$ as m,Aa as Pt,Ba as S,Ca as U,D as M,Da as $,E as A,Ea as X,Fa as T,Ga as C,H as K,Ha as _,O as s,Q as I,R as c,Ra as j,Sa as L,Ta as x,Ua as d,W as u,_a as Z,a as W,da as ut,ea as gt,fa as It,ga as vt,ha as r,i as h,ia as o,ja as l,jb as Q,ma as V,na as y,oa as g,qb as f,s as ct,sa as ht,w as N,wa as dt,xa as p,z as Y,za as w}from"./chunk-FKNLQJGV.js";var At=()=>[1,2,3,4,5];function Rt(i,t){i&1&&(r(0,"span",6)(1,"i",7),p(2,"delete"),o()())}function kt(i,t){if(i&1&&(r(0,"li")(1,"a",3),l(2,"div",4),p(3),u(4,Rt,3,0,"span",5),o()()),i&2){let e=t.$implicit,n=g();s(3),w(" file",e," "),s(),m("ngIf",n.mode.forEdit)}}function Vt(i,t){i&1&&(r(0,"li")(1,"a",3),l(2,"div",4),r(3,"i",7),p(4,"add"),o(),p(5," Add file "),o()())}var H=class i{mode={forEdit:!1};files=[];constructor(){}ngOnInit(){}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=c({type:i,selectors:[["cl-file-list"]],inputs:{mode:"mode",files:"files"},decls:3,vars:3,consts:[[1,"row","row-gap","umd-2","uc-5"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"dblock","box","box-white"],[1,"h-2","box","box-grey","spaced"],["class","lbreath",4,"ngIf"],[1,"lbreath"],[1,"liga"]],template:function(e,n){e&1&&(r(0,"ul",0),u(1,kt,5,2,"li",1)(2,Vt,6,0,"li",2),o()),e&2&&(s(),m("ngForOf",T(2,At)),s(),m("ngIf",n.mode.forEdit))},dependencies:[d,j,L,f],encapsulation:2,changeDetection:0})};var B=class i extends tt{constructor(){super("DEBUG")}static \u0275fac=function(e){return new(e||i)};static \u0275prov=N({token:i,factory:i.\u0275fac})};function $t(i,t){if(i&1){let e=V();r(0,"li"),p(1),r(2,"i",4),y("click",function(){let a=M(e).$implicit,P=g();return A(P.remove(a))}),p(3,"cross"),o()()}if(i&2){let e=t.$implicit;s(),w("",e.id," ")}}var it=class i{constructor(t){this.tagListState=t}tags=[];tags$;onTagChange=new K;ngOnInit(){this.tags$=this.tagListState.SetList(this.tags||[])}remove(t){this.tagListState.removeItem(t),this.onTagChange.emit(this.tagListState.currentList)}add(t){let e=t.target;this.tagListState.addItem({id:e.value}),this.onTagChange.emit(this.tagListState.currentList),e.value="",t.preventDefault()}static \u0275fac=function(e){return new(e||i)(I(B,8))};static \u0275cmp=c({type:i,selectors:[["cl-tag-list"]],inputs:{tags:"tags"},outputs:{onTagChange:"onTagChange"},features:[X([B])],decls:9,vars:3,consts:[[1,"row","row-gap"],[4,"ngFor","ngForOf"],[1,"liga"],["type","text","placeholder","Add new tag",1,"c-8","smaller",3,"keydown.enter"],[1,"liga","a",3,"click"]],template:function(e,n){if(e&1){let a=V();S(0),C(1,"async"),r(2,"ul",0),u(3,$t,4,1,"li",1),r(4,"li")(5,"i",2),p(6,"add"),o(),p(7," \xA0"),r(8,"input",3),y("keydown.enter",function(E){return M(a),A(n.add(E))}),o()()()}if(e&2){let a=_(1,1,n.tags$);s(3),m("ngForOf",a)}},dependencies:[d,j,x,f],encapsulation:2,changeDetection:0})};var jt=()=>({forEdit:!0}),q=class i{constructor(t,e){this.fb=t;this.toast=e}mode={forNew:!0};post;onSave=new K;postForm;ngOnInit(){this.postForm=this.fb.group({title:[],content:[],tags:[[]]}),this.post&&this.postForm.patchValue(this.post)}savePost(){if(this.toast.Hide(),this.postForm.valid){let t=this.postForm.value;this.post&&(t=W(W({},this.post),t)),this.onSave.emit(t)}else this.toast.ShowError("INVALID_FORM")}static \u0275fac=function(e){return new(e||i)(I(Ot),I(Tt))};static \u0275cmp=c({type:i,selectors:[["cl-post-form"]],inputs:{mode:"mode",post:"post"},outputs:{onSave:"onSave"},decls:13,vars:6,consts:[["novalidate","",3,"ngSubmit","formGroup"],["placeholder","Title"],["type","text","id","title","crinput","","formControlName","title",1,"cr-input","w100",3,"required"],[3,"onTagChange","tags"],[1,"spaced"],["placeholder","Start writing..."],["id","content","formControlName","content","crinput","",1,"cr-input","w100","h-5",3,"required"],[1,"f5","spaced"],[3,"mode"],[1,"spacetop"],["type","submit",1,"btn-rev"]],template:function(e,n){e&1&&(r(0,"form",0),y("ngSubmit",function(){return n.savePost()}),r(1,"cr-input",1),l(2,"input",2),o(),r(3,"cl-tag-list",3),y("onTagChange",function(P){return n.postForm.controls.tags.setValue(P)}),o(),r(4,"div",4)(5,"cr-input",5),l(6,"textarea",6),o()(),r(7,"h5",7),p(8," Attachments "),o(),l(9,"cl-file-list",8),r(10,"div",9)(11,"button",10),p(12,"Save"),o()()()),e&2&&(m("formGroup",n.postForm),s(2),m("required",!0),s(),m("tags",n.post==null?null:n.post.tags),s(3),m("required",!0),s(3),m("mode",T(5,jt)))},dependencies:[d,f,Nt,St,_t,bt,yt,wt,Lt,xt,Ft,Et,it,H],encapsulation:2,changeDetection:0})};var nt=class i{id;constructor(){}ngOnInit(){}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=c({type:i,selectors:[["cl-post-create"]],inputs:{id:"id"},decls:3,vars:0,consts:[[1,"page"],[1,"container"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1),l(2,"cl-post-form"),o()())},dependencies:[d,f,q],encapsulation:2,changeDetection:0})};var z=class i extends tt{constructor(){super()}static \u0275fac=function(e){return new(e||i)};static \u0275prov=N({token:i,factory:i.\u0275fac})};var rt=class{static MapSearchListOptions(t){return t}static MapQueryListOptions(t){let e,n=t.subpath;if(t.resourceType&&t.resourceType!=="folder"){let a=t.subpath.split("/");e=a.slice(-1),n=a.slice(0,-1).join("/")}return{type:t.type||"search",space_name:t.space||v.API.rootSpace,subpath:n||"/",filter_shortnames:e||null,search:t.keyword||"",limit:t.size||100,exact_subpath:!0,sort_type:"descending",sort_by:"resource_type",retrieve_json_payload:t.withPayload||!1}}static MapEntryListOptions(t){return{retrieve_json_payload:t.withPayload||!1,retrieve_attachments:t.withAttachments||!1,validate_schema:!0}}static MapResourceUrlListOptions(t,e){return t.replace(":resource",e.resourceType||"content").replace(":space",e.space).replace(":subpath",e.subpath)}},k=class{mapper;NewDataList(t){return{total:t.total,matches:t.matches?.map(this.mapper)}}};var O=class i{static NewInstance(t){return{id:t.id,content:t.content,author:Dt.NewInstance(t.author),created:G(t.created),replies:t.replies}}static NewInstances(t){return t.map(i.NewInstance)}static NewList(t){let e=new k;return e.mapper=i.NewInstance,e.NewDataList(t)}static PrepCreate(t){return{content:t.content}}};var ot=class i{constructor(t){this._http=t}_listUrl=v.API.comment.list;_repliesUrl=v.API.comment.replies;_createUrl=v.API.comment.create;_replyUrl=v.API.comment.reply;_deleteUrl=v.API.comment.delete;GetComments(t){let e=this._listUrl.replace(":id",t);return this._http.get(e).pipe(h(n=>O.NewList(n)))}GetReplies(t,e){let n=this._repliesUrl.replace(":id",t).replace(":cid",e);return this._http.get(n).pipe(h(a=>O.NewInstances(a)))}CreateComment(t,e){let n=this._createUrl.replace(":id",e),a=O.PrepCreate(t);return _debug(a,"CreateComment data"),this._http.post(n,a).pipe(h(P=>O.NewInstance(P)))}CreateReply(t,e,n){let a=this._replyUrl.replace(":id",e).replace(":cid",n),P=O.PrepCreate(t);return _debug(P,"CreateReply data"),this._http.post(a,P).pipe(h(E=>O.NewInstance(E)))}DeleteComment(t){let e=this._deleteUrl.replace(":id",t.id);return this._http.delete(e).pipe(h(n=>!0))}static \u0275fac=function(e){return new(e||i)(Y(Z))};static \u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})};function qt(i,t){if(i&1&&(r(0,"div",11),l(1,"cl-comment-list",12),o()),i&2){let e=g().$implicit,n=g();s(),m("id",n.id)("cid",e.id)}}function zt(i,t){if(i&1){let e=V();r(0,"li")(1,"div",3)(2,"div")(3,"i",4),p(4,"user"),o()(),r(5,"div")(6,"span",7),p(7),C(8,"relativetime"),o(),r(9,"div",8)(10,"strong"),p(11,"Updated:"),o(),p(12),o(),r(13,"div",9),y("click",function(){M(e);let a=g();return A(a.showReplies=!0)}),r(14,"i",4),p(15,"comment"),o(),p(16),o(),u(17,qt,2,2,"div",10),o()()()}if(i&2){let e=t.$implicit,n=g();s(7),Pt("",e.author==null?null:e.author.displayname," . ",_(8,5,e.created),""),s(5),w(" ",e.content," "),s(4),w(" ",e.replies,""),s(),m("ngIf",n.showReplies)}}var at=class i{constructor(t,e){this.commentListState=t;this.commentService=e}id;cid;showReplies=!1;comments$;ngOnInit(){this.cid?this.comments$=this.commentService.GetReplies(this.id,this.cid).pipe(ct(t=>this.commentListState.SetList(t))):this.comments$=this.commentService.GetComments(this.id).pipe(ct(t=>this.commentListState.SetList(t.matches)))}add(t){this.cid?this.commentService.CreateReply({content:t.value},this.id,this.cid).subscribe({next:e=>{this.commentListState.addItem(e),t.value=""}}):this.commentService.CreateComment({content:t.value},this.id).subscribe({next:e=>{this.commentListState.addItem(e),t.value=""}})}static \u0275fac=function(e){return new(e||i)(I(z),I(ot))};static \u0275cmp=c({type:i,selectors:[["cl-comment-list"]],inputs:{id:"id",cid:"cid"},features:[X([z])],decls:15,vars:3,consts:[["comment",""],[1,"row-list"],[4,"ngFor","ngForOf"],[1,"grid","g-1"],[1,"liga"],["type","text","placeholder","Write a comment...",1,"cr-input","c-10",3,"keydown.enter"],[1,"liga",3,"click"],[1,"smaller"],[1,"breath"],[1,"spaced",3,"click"],["class","box",4,"ngIf"],[1,"box"],[3,"id","cid"]],template:function(e,n){if(e&1){let a=V();S(0),C(1,"async"),r(2,"ul",1),u(3,zt,18,7,"li",2),r(4,"li")(5,"div",3)(6,"div")(7,"i",4),p(8,"user"),o()(),r(9,"div")(10,"input",5,0),y("keydown.enter",function(){M(a);let E=dt(11);return A(n.add(E))}),o(),p(12,"\xA0 "),r(13,"a",6),y("click",function(){M(a);let E=dt(11);return A(n.add(E))}),p(14,"send"),o()()()()()}if(e&2){let a=_(1,1,n.comments$);s(3),m("ngForOf",a)}},dependencies:[i,d,j,L,x,f,Mt],encapsulation:2,changeDetection:0})};var st=class{static NewInstance(t){return{value:t.value,reason:t.reason}}};var D=class i{static NewInstance(t){return{id:t.id,title:t.title,content:t.content,created:G(t.created),updated:G(t.updated),excerpt:t.excerpt,tags:t.tags?.map(e=>({id:e})),author:t.author,stats:{comments:t.stats.comments,votes:t.stats.votes},status:st.NewInstance(t.status),voted:!1}}static NewInstances(t){return t.map(i.NewInstance)}static NewList(t){let e=new k;return e.mapper=i.NewInstance,e.NewDataList(t)}static PrepCreate(t){return{id:t.id}}static PrepSave(t){return{id:t.id}}};var F=class i{constructor(t){this._http=t}_listUrl=v.API.post.list;_detailsUrl=v.API.post.details;_createUrl=v.API.post.create;_saveUrl=v.API.post.save;_deleteUrl=v.API.post.delete;GetPosts(t={}){let e=Ct(rt.MapSearchListOptions(t)),n=this._listUrl.replace(":options",e);return this._http.get(n).pipe(h(a=>D.NewList(a)))}GetPost(t){let e=this._detailsUrl.replace(":id",t);return this._http.get(e).pipe(h(n=>D.NewInstance(n)))}CreatePost(t){let e=this._createUrl,n=D.PrepCreate(t);return _debug(n,"CreatePost data"),this._http.post(e,n).pipe(h(a=>D.NewInstance(a)))}SavePost(t){let e=this._saveUrl.replace(":id",t.id),n=D.PrepSave(t);return _debug(n,"SavePost data"),this._http.put(e,n).pipe(h(a=>t))}DeletePost(t){let e=this._deleteUrl.replace(":id",t.id);return this._http.delete(e).pipe(h(n=>!0))}static \u0275fac=function(e){return new(e||i)(Y(Z))};static \u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})};var Wt=()=>({full:!0});function Yt(i,t){i&1&&(r(0,"div"),p(1," This is a draft. "),o())}function Kt(i,t){if(i&1&&(r(0,"div",2),u(1,Yt,2,0,"div",3),r(2,"div",4)(3,"a",5),p(4,"Edit"),o(),p(5," | Publish | Delete "),o()(),l(6,"cl-post-card",6),r(7,"div",7),p(8),o(),r(9,"div",7),l(10,"cl-file-list"),o(),l(11,"cl-comment-list",8)),i&2){g();let e=$(2);s(),m("ngIf",e.status.value==="DRAFT"),s(2),ht("routerLink","/posts/edit/",e.id,""),s(3),m("mode",T(7,Wt))("post",e),s(2),w(" ",e.content," "),s(3),m("id",e.id)}}var pt=class i{constructor(t){this.postService=t}id;post$;ngOnInit(){this.post$=this.postService.GetPost(this.id)}static \u0275fac=function(e){return new(e||i)(I(F))};static \u0275cmp=c({type:i,selectors:[["cl-post-details"]],inputs:{id:"id"},decls:5,vars:4,consts:[[1,"page"],[1,"container"],[1,"box","box-grey-light","card","spaced"],[4,"ngIf"],[1,"tail"],[3,"routerLink"],[1,"spaced","dblock",3,"mode","post"],[1,"spaced"],[3,"id"]],template:function(e,n){if(e&1&&(r(0,"div",0)(1,"div",1),S(2),C(3,"async"),u(4,Kt,12,8),o()()),e&2){s(2);let a=U(_(3,1,n.post$));s(2),ut(a?4:-1)}},dependencies:[d,L,x,f,Q,et,at,H],encapsulation:2,changeDetection:0})};var Xt=()=>({forEdit:!0});function Zt(i,t){if(i&1&&l(0,"cl-post-form",3),i&2){g();let e=$(2);m("mode",T(2,Xt))("post",e)}}var mt=class i{constructor(t){this.postService=t}id;post$;ngOnInit(){this.post$=this.postService.GetPost(this.id)}static \u0275fac=function(e){return new(e||i)(I(F))};static \u0275cmp=c({type:i,selectors:[["cl-post-edit"]],inputs:{id:"id"},decls:5,vars:4,consts:[[1,"page"],[1,"container"],[3,"mode","post",4,"ngIf"],[3,"mode","post"]],template:function(e,n){if(e&1&&(r(0,"div",0)(1,"div",1),S(2),C(3,"async"),u(4,Zt,1,3,"cl-post-form",2),o()()),e&2){s(2);let a=U(_(3,1,n.post$));s(2),m("ngIf",a)}},dependencies:[d,L,x,f,q],encapsulation:2,changeDetection:0})};function Qt(i,t){if(i&1&&(r(0,"li"),l(1,"cl-post-card",6),o()),i&2){let e=t.$implicit;s(),m("post",e)}}function te(i,t){if(i&1&&(r(0,"ul",5),It(1,Qt,2,1,"li",null,gt),o()),i&2){g();let e=$(2);s(),vt(e.matches)}}var lt=class i{constructor(t){this.postService=t}posts$;ngOnInit(){this.posts$=this.postService.GetPosts()}static \u0275fac=function(e){return new(e||i)(I(F))};static \u0275cmp=c({type:i,selectors:[["cl-post"]],decls:8,vars:4,consts:[[1,"page"],[1,"container"],[1,"spaced"],["routerLink","/posts/create",1,"btn","btn-diff"],["class","rowlist",4,"ngIf"],[1,"rowlist"],[3,"post"]],template:function(e,n){if(e&1&&(r(0,"div",0)(1,"div",1),S(2),C(3,"async"),r(4,"div",2)(5,"button",3),p(6,"Create a new idea"),o()(),u(7,te,3,0,"ul",4),o()()),e&2){s(2);let a=U(_(3,1,n.posts$));s(5),m("ngIf",a==null?null:a.matches)}},dependencies:[d,L,x,f,Q,et],encapsulation:2,changeDetection:0})};var Zi=[{path:"",component:lt},{path:"create",component:nt},{path:"edit/:id",component:mt},{path:":id",component:pt}];export{Zi as PostRoutes};
