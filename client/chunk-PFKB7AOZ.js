import{b as r,c as h}from"./chunk-J6H3ZUJ6.js";import{b as u}from"./chunk-RCT625XJ.js";import{gb as f,m as c,vb as s,w as a,z as i}from"./chunk-2RYABZQO.js";var l=class n extends u{constructor(e,t,S){super();this.configService=e;this.localStorage=t;this.router=S;this.configService.config$.pipe(c(o=>o.isServed)).subscribe({next:()=>{let o=this._GetUser();this.CheckAuth(o)?this.SetState(o):this.Logout(!1)}})}get redirectUrl(){return this.localStorage.getItem(s.Auth.redirectKey)}set redirectUrl(e){this.localStorage.setItem(s.Auth.redirectKey,e)}_SaveUser(e){this.localStorage.setItem(r.Config.Auth.userAccessKey,e,e.expiresAt)}_RemoveUser(){this.localStorage.removeItem(r.Config.Auth.userAccessKey)}_GetUser(){let e=this.localStorage.getItem(r.Config.Auth.userAccessKey);return e&&e.accessToken?e:null}SaveSession(e){return e.accessToken?(this._SaveUser(e),this.SetState(e),e):(this._RemoveUser(),this.RemoveState(),null)}UpdateSession(e){let t=this._GetUser();t?(t.accessToken=e.accessToken,this._SaveUser(t),this.UpdateState(e)):(this._RemoveUser(),this.RemoveState())}CheckAuth(e){return!(!e||!e.accessToken||Date.now()>e.expiresAt)}Logout(e=!1){this.RemoveState(),this._RemoveUser(),e&&this.router.navigateByUrl(s.Auth.loginRoute)}GetToken(){let e=this.currentItem;return this.CheckAuth(e)?e.accessToken:null}static \u0275fac=function(t){return new(t||n)(i(r),i(h),i(f))};static \u0275prov=a({token:n,factory:n.\u0275fac,providedIn:"root"})};export{l as a};
